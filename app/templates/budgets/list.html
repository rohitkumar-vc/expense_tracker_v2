{% extends "base.html" %}

{% block title %}Budgets - Expense Manager{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex justify-between items-center">
        <h1 class="text-3xl font-bold">Monthly Budgets</h1>
        <button onclick="document.getElementById('addBudgetModal').classList.remove('hidden')"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
            <span class="material-symbols-outlined mr-2">add</span>
            Add Budget
        </button>
    </div>

    <!-- Current Month Info -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <p class="text-blue-900">Viewing budgets for: <strong>{{ current_month }}/{{ current_year }}</strong></p>
    </div>

    <!-- Budget Status Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for status in budget_status %}
        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 
            {% if status.is_exceeded %}border-red-500{% else %}border-green-500{% endif %}">
            <div class="flex justify-between items-start mb-3">
                <div>
                    <h3 class="font-bold text-gray-900 text-lg">{{ status.category }}</h3>
                    <p class="text-sm text-gray-600">Budget: ${{ "%.2f"|format(status.budget) }}</p>
                </div>
                <span class="material-symbols-outlined text-2xl 
                    {% if status.is_exceeded %}text-red-500{% else %}text-green-500{% endif %}">
                    {% if status.is_exceeded %}error{% else %}check_circle{% endif %}
                </span>
            </div>

            <div class="mb-2">
                <div class="flex justify-between text-sm mb-1">
                    <span>Spent: ${{ "%.2f"|format(status.spent) }}</span>
                    <span class="font-semibold">{{ "%.1f"|format(status.percentage) }}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div class="h-3 rounded-full {% if status.is_exceeded %}bg-red-500{% else %}bg-green-500{% endif %}"
                        style="width: {{ [status.percentage, 100]|min }}%"></div>
                </div>
            </div>

            <p class="text-sm {% if status.is_exceeded %}text-red-600{% else %}text-green-600{% endif %} font-medium">
                {% if status.is_exceeded %}
                Over budget by ${{ "%.2f"|format(status.spent - status.budget) }}
                {% else %}
                Remaining: ${{ "%.2f"|format(status.budget - status.spent) }}
                {% endif %}
            </p>
        </div>
        {% endfor %}

        {% if not budget_status %}
        <div class="col-span-full text-center py-12 text-gray-500">
            <span class="material-symbols-outlined text-6xl mb-4 block">savings</span>
            <p>No budgets set for this month. Create one to start tracking!</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Add Budget Modal -->
<div id="addBudgetModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl max-w-md w-full p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold">Add Budget</h3>
            <button onclick="document.getElementById('addBudgetModal').classList.add('hidden')">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>

        <form method="POST" action="/budgets/create" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1">Category *</label>
                <select name="category_id" required
                    class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">Select Category</option>
                    {% for cat in expense_categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">Budget Amount *</label>
                <input type="number" name="amount" step="0.01" required
                    class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Month *</label>
                    <input type="number" name="month" min="1" max="12" value="{{ current_month }}" required
                        class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Year *</label>
                    <input type="number" name="year" min="2020" value="{{ current_year }}" required
                        class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
            </div>

            <div class="flex gap-3">
                <button type="submit" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg font-medium">
                    Save Budget
                </button>
                <button type="button" onclick="document.getElementById('addBudgetModal').classList.add('hidden')"
                    class="flex-1 bg-gray-200 px-4 py-2 rounded-lg font-medium">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}